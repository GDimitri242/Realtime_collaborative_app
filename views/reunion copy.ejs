<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <title><%= title %></title>
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>
        <header class="header">
            <h1>Ec2lt Reunion</h1>
        </header>
        <main class="main reunion-page">
            <div class="reunion-header">
                <div class="reunion-info">
                    <h2>Réunion : <%= idReunion %></h2>
                    <p>Participant : <%= nomUtilisateur %></p>
                </div>
                <div class="reunion-controles">
                    
                    <button id="boutonAudio" class="bouton controle audio-actif">
                        Audio activé
                    </button>
                    <button id="boutonVideo" class="bouton controle video-actif">
                        Vidéo activée
                    </button>
                    <button id="boutonPartageEcran" class="bouton controle">
                        Partager l'écran
                    </button>
                    <button id="boutonQuitter" class="bouton bouton-danger">
                        Quitter
                    </button>
                    <!-- Dans la barre de contrôles, ajoutez ce bouton -->
                    <button id="boutonPartageLien" class="btn join-item btn-sm lg:btn-md gap-2 bg-purple-500 border-purple-500 text-white">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                        </svg>
                        Inviter à rejoindre
                    </button>
                    <!-- Modal de partage -->
                    <dialog id="partageModal" class="modal">
                    <div class="modal-box bg-base-200 max-w-2xl">
                        <h3 class="font-bold text-lg mb-4">Partager la réunion</h3>
                        
                        <!-- Lien d'invitation -->
                        <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold">Lien d'invitation</span>
                        </label>
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                id="lienInvitation" 
                                readonly 
                                class="input input-bordered flex-1 bg-white" 
                                placeholder="Génération du lien..."
                            >
                            <button id="copierLien" class="btn btn-primary">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copier
                            </button>
                        </div>
                        </div>

                        <!-- Options de partage -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <!-- Partage par email -->
                        <div class="card bg-base-100 shadow-sm">
                            <div class="card-body p-4">
                            <h4 class="card-title text-sm flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                Email
                            </h4>
                            <p class="text-xs opacity-70">Inviter par email</p>
                            <div class="card-actions justify-end mt-2">
                                <button id="partageEmail" class="btn btn-sm btn-outline">
                                Ouvrir Email
                                </button>
                            </div>
                            </div>
                        </div>

                        <!-- Partage vers apps -->
                        <div class="card bg-base-100 shadow-sm">
                            <div class="card-body p-4">
                            <h4 class="card-title text-sm flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                </svg>
                                Applications
                            </h4>
                            <p class="text-xs opacity-70">Partager sur d'autres apps</p>
                            <div class="card-actions justify-end mt-2">
                                <button id="partageNative" class="btn btn-sm btn-outline" disabled>
                                Bientôt
                                </button>
                            </div>
                            </div>
                        </div>
                        </div>

                        <!-- Code de la réunion -->
                        <div class="bg-base-300 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                            <p class="font-semibold">Code de la réunion</p>
                            <p class="text-2xl font-bold text-primary"><%= idReunion %></p>
                            <p class="text-xs opacity-70">Partagez ce code pour rejoindre rapidement</p>
                            </div>
                            <button id="copierCode" class="btn btn-ghost btn-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            </button>
                        </div>
                        </div>

                        <div class="modal-action">
                        <form method="dialog">
                            <button class="btn">Fermer</button>
                        </form>
                        </div>
                    </div>
                    </dialog>

                    <!-- Toast de confirmation -->
                    <div id="toast" class="toast toast-top toast-center hidden">
                    <div class="alert alert-success">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        <span id="toastMessage">Lien copié !</span>
                    </div>
                    </div>
                </div>

                <div class="reunion-contenu">
                    <div class="zone-principale">
                        <div id="videoLocal" class="video-container">
                            <video id="maVideo" autoplay muted></video>
                            <div class="video-label">Vous</div>
                        </div>
                        <div id="partageEcranContainer" class="partage-ecran-container" style="display: none;">
                            <video id="videoPartageEcran" autoplay></video>
                            <div class="partage-ecran-label">Partage d'écran</div>
                        </div>
                    </div>
                    <div class="zone-laterale">
                        <div class="participants-section">
                            <h3>Participants</h3>
                            <div id="listeParticipants" class="liste-participants">
                                <!-- Les participants seront ajoutés dynamiquement -->
                            </div>
                        </div>
                        <div class="videos-participants">
                            <div id="videosDistantes" class="videos-distantes">
                                <!-- Les vidéos des autres participants seront ajoutées ici -->
                            </div>
                        </div>
                    </div>
                </div>
                <div id="messageStatut" class="message-statut" style="display: none;">
                    <!-- Messages de statut (partage d'écran, etc.) -->
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>
                © EC2LT - 2023-2025 - Tous droits réservés | Ministère de l'Enseignement 
                Supérieur, de la Recherche et de l'Innovation (MESRI)
                École Centrale des Logiciels Libres et de Télécommunications (EC2LT) | Développeur: 
                [NASRY AHAMADI]
            </p>
        </footer>

        <!-- Scripts -->
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
        <script src="/js/script.js"></script>
        <script>
            // Initialiser la réunion
            window.onload = function() {
                const idReunion = '<%= idReunion %>';
                const nomUtilisateur = '<%= nomUtilisateur %>';
                initialiserReunion(idReunion, nomUtilisateur);
            };
        </script>
    
    </body>
</html>